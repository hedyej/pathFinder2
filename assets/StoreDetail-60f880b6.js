import{r as z,i as te,a as l,o as r,l as B,w as s,c as d,F,m as E,b as e,v as ae,x as H,y as ne,z as ee,h as o,A as t,f as _,t as i,B as J,E as se,C as re,_ as me,D as _e,q as ce,u as pe,s as q,G as K,p as fe,g as ge,n as ve,W as he}from"./index-0a41ef8e.js";import{u as Q,a as ue,h as le,b as ye,_ as be}from"./CommentCard-fe64dc97.js";import{b as ke}from"./store-0f54d121.js";const we={__name:"FilterSelection",setup(D){const O=Q(),{pageSorter:v}=O,b=z(""),h=()=>{b.value==="scoreOrderAsc"?v("score",1,"asc"):b.value==="scoreOrderDesc"?v("score",1,"desc"):b.value==="DateOrderAsc"?v("createDate",1,"desc"):b.value==="DateOrderDesc"&&v("createDate",1,"asc")},a=[{value:"scoreOrderDesc",label:"評分高到低"},{value:"scoreOrderAsc",label:"評分低到高"},{value:"DateOrderAsc",label:"由新到舊"},{value:"DateOrderDesc",label:"由舊到新"}];return te(()=>{b.value="DateOrderAsc"}),(y,m)=>{const Y=l("el-option"),k=l("el-select");return r(),B(k,{modelValue:b.value,"onUpdate:modelValue":m[0]||(m[0]=f=>b.value=f),class:"m-2",style:{"margin-right":"-1px"},onChange:h},{default:s(()=>[(r(),d(F,null,E(a,f=>e(Y,{key:f.value,label:f.label,value:f.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])}}},xe={class:"text-grey cursor-pointer",style:{"text-align":"end"}},Ce={class:"text-dark"},Ve={class:"text-grey"},De={key:0},$e=o("h5",{class:"mb-4"},"填寫基本資訊",-1),Ie={key:1},Se=o("h5",{class:"mb-4"},"心得分享",-1),Ue={key:0},qe={key:1},Ye={__name:"CommentModal",setup(D){const O=ae(),{user:v}=H(O),b=Q(),{modalPage:h,form:a,isOpen:y}=H(b),{submitComment:m,closeModal:Y}=b,k=z("匿名");ne(k,async()=>{k.value==="匿名"?a.value.userId=0:k.value==="本人"&&(v.value.id===0?se.confirm("尚未登入","請先登入帳號",{confirmButtonText:"OK",cancelButtonText:"取消",type:"warning",showClose:!1}).then(()=>{k.value="匿名"}):a.value.userId=v.value.id)});const f=new Date().getFullYear(),N=[];for(let g=0;g<50;g+=1)N.push(f-g);const A=g=>{a.value.advantages.forEach((c,x)=>{g.value===c.value&&(a.value.advantages[x].status=!a.value.advantages[x].status)})},$=g=>{a.value.disAdvantages.forEach((c,x)=>{g.value===c.value&&(a.value.disAdvantages[x].status=!a.value.disAdvantages[x].status)})},R=z(null),P=ee({anonymous:[{required:!0,message:"請輸入必填內容",trigger:"blur"}],hoildayYear:[{required:!0,message:"請輸入必填內容",trigger:"change"}],workDays:[{required:!0,message:"請輸入必填內容",trigger:"blur"},{type:"number",message:"請輸入數字",trigger:"blur"},{type:"number",min:1,message:"必須大於0",trigger:"blur"}],workHours:[{required:!0,message:"請輸入必填內容",trigger:"blur"},{type:"number",message:"請輸入數字",trigger:"blur"},{type:"number",min:1,message:"必須大於0",trigger:"blur"}]}),w=z(null),p=ee({score:[{required:!0,message:"請輸入必填內容",trigger:"blur"}],description:[{required:!0,message:"請輸入必填內容",trigger:"blur"}]}),I=()=>{R.value.validate(g=>{g&&(h.value=2)})},U=async()=>{w.value.validate(g=>{g&&w.value&&w.value.clearValidate()}),await m()},M=g=>{se.confirm("資料將不會保留，確定離開嗎？",{showClose:!1}).then(()=>{g(),R.value&&R.value.clearValidate(),w.value&&w.value.clearValidate(),Y()})};return(g,c)=>{const x=l("font-awesome-icon"),S=l("el-radio-button"),W=l("el-radio-group"),C=l("el-form-item"),j=l("el-option"),V=l("el-select"),u=l("el-input-number"),T=l("el-form"),G=l("el-check-tag"),X=l("el-rate"),L=l("el-input"),Z=l("el-button"),ie=l("el-dialog");return r(),B(ie,{modelValue:t(y),"onUpdate:modelValue":c[7]||(c[7]=n=>J(y)?y.value=n:null),style:{width:"90%","max-width":"600px"},"before-close":M,"show-close":!1,"lock-scroll":"","align-center":""},{header:s(({close:n})=>[o("div",xe,[e(x,{icon:["fas","xmark"],onClick:n},null,8,["onClick"])])]),footer:s(()=>[t(h)===1?(r(),d("div",Ue,[e(Z,{type:"primary",onClick:I},{default:s(()=>[_(" 下一頁 ")]),_:1})])):(r(),d("div",qe,[e(Z,{onClick:c[6]||(c[6]=n=>h.value=1)},{default:s(()=>[_(" 上一頁 ")]),_:1}),e(Z,{type:"primary",onClick:U},{default:s(()=>[_(" 送出")]),_:1})]))]),default:s(()=>[o("div",null,[o("h2",Ce,[_(" 評論撰寫 "),o("span",Ve,"("+i(t(h))+"/2)",1)]),t(h)===1?(r(),d("div",De,[$e,e(T,{"label-position":"top","label-width":"100px",model:t(a),ref_key:"formRef1",ref:R,rules:P},{default:s(()=>[e(C,{label:"評論身份",prop:"anonymous"},{default:s(()=>[e(W,{modelValue:k.value,"onUpdate:modelValue":c[0]||(c[0]=n=>k.value=n)},{default:s(()=>[e(S,{label:"匿名"}),e(S,{label:"本人"})]),_:1},8,["modelValue"])]),_:1}),e(C,{label:"換宿年份",prop:"hoildayYear"},{default:s(()=>[e(V,{modelValue:t(a).hoildayYear,"onUpdate:modelValue":c[1]||(c[1]=n=>t(a).hoildayYear=n),placeholder:"選擇年份",style:{width:"240px"}},{default:s(()=>[(r(),d(F,null,E(N,n=>e(j,{key:n,label:n,value:n},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(C,{label:"換宿周數",prop:"workDays"},{default:s(()=>[e(u,{modelValue:t(a).workDays,"onUpdate:modelValue":c[2]||(c[2]=n=>t(a).workDays=n),modelModifiers:{number:!0},style:{width:"240px"},min:0},null,8,["modelValue"])]),_:1}),e(C,{label:" 換宿日工時",prop:"workHours"},{default:s(()=>[e(u,{modelValue:t(a).workHours,"onUpdate:modelValue":c[3]||(c[3]=n=>t(a).workHours=n),modelModifiers:{number:!0},style:{width:"240px"},min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])):(r(),d("div",Ie,[Se,e(T,{"label-position":"top","label-width":"100px",model:t(a),ref_key:"formRef2",ref:w,rules:p},{default:s(()=>[e(C,{label:"優點福利"},{default:s(()=>[(r(!0),d(F,null,E(t(a).advantages,n=>(r(),B(G,{checked:n.status,onChange:de=>A(n),key:n.value,class:"me-1 mb-1 check-tag"},{default:s(()=>[_(i(n.value),1)]),_:2},1032,["checked","onChange"]))),128))]),_:1}),e(C,{label:"有待改善"},{default:s(()=>[(r(!0),d(F,null,E(t(a).disAdvantages,n=>(r(),B(G,{checked:n.status,onChange:de=>$(n),key:n.value,class:"me-1 mb-1 check-tag"},{default:s(()=>[_(i(n.value),1)]),_:2},1032,["checked","onChange"]))),128))]),_:1}),e(C,{label:"整體評分",prop:"score"},{default:s(()=>[e(X,{modelValue:t(a).score,"onUpdate:modelValue":c[4]||(c[4]=n=>t(a).score=n),size:"large"},null,8,["modelValue"])]),_:1}),e(C,{label:"換宿內容分享",prop:"description"},{default:s(()=>[e(L,{modelValue:t(a).description,"onUpdate:modelValue":c[5]||(c[5]=n=>t(a).description=n),rows:5,type:"textarea",placeholder:"分享你的換宿生活，有關店家環境、工作狀況和換宿生活等"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]))])]),_:1},8,["modelValue"])}}},Me=D=>re("post","/replys",D),Oe=D=>re("delete",`/replys/${D}`);const oe=D=>(fe("data-v-b9f4b3bd"),D=D(),ge(),D),Ae={class:"text-grey cursor-pointer",style:{"text-align":"end"}},Re={class:"d-flex mb-2",style:{"justify-content":"space-between"}},Be={class:"d-flex"},Fe=["src"],Ee={class:"text-grey"},He={key:0,class:"text-dark"},Ne={class:"card-light-tag",style:{"align-self":"flex-start"}},Te={style:{"margin-bottom":"0px"}},Le={class:"text-grey"},ze={class:"mb-1 me-1"},Pe=oe(()=>o("span",null,"小時",-1)),We=oe(()=>o("span",{class:"me-1"},"·",-1)),je={class:"mb-1"},Ge=oe(()=>o("span",null,"周",-1)),Ke={class:"mb-2 text-dark"},Je={key:0},Qe={key:0},Xe={style:{width:"56px",height:"56px"},class:"me-2"},Ze=["src"],et={style:{"flex-grow":"1"},class:"text-dark"},tt={class:"text-grey"},ot={style:{height:"22px",width:"29px"},class:"d-flex align-center"},st={class:"d-flex mb-3"},lt=["src"],at={style:{"flex-grow":"1"}},nt={class:"text-dark"},rt={__name:"CommentDetailModal",setup(D){const O=ae(),{user:v}=H(O),b=_e(()=>v.value.id!==0),h=z(!1),a=ue(),{isDetailOpen:y,commentDetail:m,commentId:Y}=H(a),{fetchComment:k}=a,f=ee({}),N=async()=>{h.value?f.userId=0:f.userId=v.value.id,f.createDate=Date.now(),f.commentId=Number(Y.value);try{await Me(f),await k(),K({message:"新增成功",type:"success"}),f.content=""}catch{K({message:"新增失敗",type:"error"})}},A=async w=>{try{await Oe(w),await k(),K({message:"刪除成功",type:"success"})}catch{K({message:"刪除失敗",type:"error"})}},$=ce(),R=pe(),P=async()=>{y.value=!1;const{storeId:w}=$.query,p=Q(),{pageSorter:I}=p,{sorterInfo:U}=H(p);await I(U.value.nowType,U.value.nowPage,U.value.nowSorter),R.push(`/storeDetail/${w}`)};return ne(()=>$.query.commentId,async()=>{$.query.commentId&&(Y.value=$.query.commentId,await k())}),te(async()=>{$.query.commentId&&(Y.value=$.query.commentId,await k())}),(w,p)=>{const I=l("font-awesome-icon"),U=l("el-tag"),M=l("el-divider"),g=l("el-dropdown-item"),c=l("el-dropdown-menu"),x=l("el-dropdown"),S=l("el-input"),W=l("el-checkbox"),C=l("el-button"),j=l("el-dialog");return t(y)?(r(),B(j,{key:0,modelValue:t(y),"onUpdate:modelValue":p[2]||(p[2]=V=>J(y)?y.value=V:null),style:{width:"90%","max-width":"600px"},"before-close":P,class:"el-dialog","show-close":!1,visible:t(y),"onUpdate:visible":p[3]||(p[3]=V=>J(y)?y.value=V:null),"lock-scroll":"","align-center":""},{header:s(({close:V})=>[o("div",Ae,[e(I,{icon:["fas","xmark"],onClick:V},null,8,["onClick"])])]),default:s(()=>{var V;return[o("div",null,[o("div",Re,[o("div",Be,[(V=t(m).user)!=null&&V.imgUrl?(r(),d("img",{key:0,src:t(m).user.imgUrl,class:"me-2 profileImg"},null,8,Fe)):q("",!0),o("div",Ee,[t(m).user.name?(r(),d("h4",He,i(t(m).user.name),1)):q("",!0),o("p",null,i(t(le)(t(m).createDate).format("YYYY-MM-DD")),1)])]),o("div",Ne,[o("h5",Te,[e(I,{icon:["fas","star"],class:"me-1"}),_(i(t(m).score)+" 分 ",1)])])]),o("div",null,[o("p",Le,[o("span",ze,[e(I,{icon:["fas","clock"],class:"me-1"}),_("日工時： "+i(t(m).workHours)+" ",1),Pe]),We,o("span",je,[e(I,{icon:["fas","calendar-days"],class:"me-1"}),_("換宿： "+i(t(m).workDays)+" ",1),Ge])])]),o("p",Ke,i(t(m).description),1),(r(!0),d(F,null,E(t(m).advantages,u=>(r(),d("span",{key:u},[u.status?(r(),d("span",Je,[e(U,{class:"me-1",type:"info","disable-transitions":""},{default:s(()=>[_(i(u.value),1)]),_:2},1024)])):q("",!0)]))),128)),(r(!0),d(F,null,E(t(m).disAdvantages,u=>(r(),d("span",{key:u},[u.status?(r(),d("span",Qe,[e(U,{class:"me-1",type:"info","disable-transitions":""},{default:s(()=>[_(i(u.value),1)]),_:2},1024)])):q("",!0)]))),128)),e(ye,{comment:t(m)},null,8,["comment"]),e(M,{class:"my-2"}),(r(!0),d(F,null,E(t(m).replys,u=>(r(),d("div",{class:"d-flex mb-3 text-grey",key:u.id},[o("div",Xe,[o("img",{src:u.imgUrl,class:"profileImg"},null,8,Ze)]),o("div",et,[o("h4",null,i(u.name),1),o("p",null,i(u.content),1),o("p",tt,i(t(le)(u.createDate).format("YYYY-MM-DD")),1)]),o("div",null,[u.userId===t(v).id&&t(v).id!==0?(r(),B(x,{key:0,trigger:"click"},{dropdown:s(()=>[e(c,null,{default:s(()=>[e(g,{onClick:T=>A(u.id)},{default:s(()=>[_("刪除")]),_:2},1032,["onClick"])]),_:2},1024)]),default:s(()=>[o("span",null,[o("div",ot,[e(I,{icon:["fas","ellipsis-vertical"]})])])]),_:2},1024)):q("",!0)])]))),128)),o("div",st,[o("img",{src:t(v).imgUrl,class:"me-2 profileImg mb-3"},null,8,lt),o("div",at,[o("h4",nt,i(t(v).name),1),e(S,{modelValue:f.content,"onUpdate:modelValue":p[0]||(p[0]=u=>f.content=u),rows:3,type:"textarea",placeholder:"輸入回覆...",class:"mb-1"},null,8,["modelValue"]),o("div",null,[t(b)?(r(),B(W,{key:0,modelValue:h.value,"onUpdate:modelValue":p[1]||(p[1]=u=>h.value=u)},{default:s(()=>[_("匿名回覆")]),_:1},8,["modelValue"])):q("",!0)]),e(C,{type:"primary",onClick:N},{default:s(()=>[_("送出")]),_:1})])])])]}),_:1},8,["modelValue","visible"])):q("",!0)}}},ct=me(rt,[["__scopeId","data-v-b9f4b3bd"]]),ut={class:"d-flex align-center mb-2"},it={class:"me-2"},dt={class:"rounded block"},mt={class:"d-flex align-center"},_t={class:"me-2 text-accent"},pt={class:"text-grey mb-2"},ft={class:"mb-1"},gt={class:"mb-1"},vt={class:"mb-1"},ht=o("span",null,"小時",-1),yt={class:"mb-1"},bt=o("span",null,"周",-1),kt={class:"d-flex align-center",style:{"justify-content":"space-between",height:"64px"}},wt={class:"text-grey bold",style:{margin:"0"}},xt={key:1,class:"text-center text-grey py-3"},Ct=o("h5",null,"尚無評論",-1),It={__name:"StoreDetail",setup(D){const O=ve();O.setIsLoading();const v=Q(),{comments:b,allComments:h,storeId:a,sorterInfo:y,form:m,type:Y,isOpen:k,averageWorkDays:f,averageWorkHours:N,averageScore:A}=H(v),{pageSorter:$,fetchAllComments:R}=v,P=ue(),{isDetailOpen:w}=H(P),p=z({}),I=async()=>{const{data:c}=await ke(a.value);p.value=c},U=()=>{k.value=!0,Y.value="create",m.value.storeId=a.value},M=ce();M.params.id?a.value=parseInt(M.params.id,10):M.query.storeId&&M.query.commentId&&(a.value=parseInt(M.query.storeId,10),w.value=!0);const g=async c=>{await $(y.value.nowType,c,y.value.nowSorter)};return te(async()=>{await I(),await R(a.value),await $("createDate",1,"desc"),O.setIsLoading()}),(c,x)=>{const S=l("font-awesome-icon"),W=l("router-link"),C=l("el-image"),j=l("el-rate"),V=l("el-button"),u=l("el-card"),T=l("el-col"),G=l("el-pagination"),X=l("el-row");return r(),d("div",null,[e(ct),e(Ye),e(he,null,{default:s(()=>[e(W,{to:{name:"searchStore"},class:"text-primary bold router-link mb-1"},{default:s(()=>[e(S,{icon:["fas","arrow-left"],class:"me-1"}),_("返回搜尋")]),_:1}),e(X,{gutter:20,class:"mt-2"},{default:s(()=>[e(T,{xs:24,md:8},{default:s(()=>[e(u,null,{default:s(()=>[o("div",ut,[o("div",it,[o("div",dt,[e(C,{style:{width:"100px",height:"100px"},src:p.value.imgUrl,fit:"cover",class:"rounded"},null,8,["src"])])]),o("div",null,[o("h3",null,i(p.value.name),1),o("div",mt,[o("h2",_t,i(t(A)),1),e(j,{modelValue:t(A),"onUpdate:modelValue":x[0]||(x[0]=L=>J(A)?A.value=L:null),disabled:"",colors:["#F48C2B","#F48C2B","#F48C2B"],size:"large"},null,8,["modelValue"])])])]),o("div",pt,[o("p",ft,[e(S,{icon:["fas","location-dot"],class:"me-1"}),_(i(p.value.address),1)]),o("p",gt,[e(S,{icon:["fas","phone"],class:"me-1"}),_(i(p.value.tel),1)]),o("p",vt,[e(S,{icon:["fas","clock"],class:"me-1"}),_("平均工時： "+i(t(N))+" ",1),ht]),o("p",yt,[e(S,{icon:["fas","calendar-days"],class:"me-1"}),_("平均換宿： "+i(t(f))+" ",1),bt])]),e(V,{type:"primary",style:{display:"block",margin:"auto"},size:"large",onClick:U},{default:s(()=>[_("撰寫貼文")]),_:1})]),_:1})]),_:1}),e(T,{xs:24,md:16},{default:s(()=>[o("div",kt,[o("p",wt,i(t(h).length)+" 則評論",1),t(h).length?(r(),B(we,{key:0})):q("",!0)]),t(h).length?(r(!0),d(F,{key:0},E(t(b),L=>(r(),d("div",{key:L.id},[e(be,{comment:L,isAction:!0},null,8,["comment"])]))),128)):q("",!0),t(h).length===0?(r(),d("div",xt,[e(S,{icon:["fas","face-sad-tear"],style:{width:"80",height:"80"},class:"mb-1"}),Ct])):q("",!0),e(G,{background:"",layout:"prev, pager, next",total:t(h).length,onCurrentChange:g,"hide-on-single-page":t(b).length===10||t(b).length<10,"current-page":t(y).nowPage},null,8,["total","hide-on-single-page","current-page"])]),_:1})]),_:1})]),_:1})])}}};export{It as default};
