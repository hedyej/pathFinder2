import{r as N,i as Z,a as s,o as n,k as O,w as l,c as i,F as A,j as M,b as e,n as le,s as F,q as se,v as X,x as t,f as p,h as o,t as d,y as ee,E as te,z as ae,A as de,l as ne,u as ie,m as B,B as K,W as me}from"./index-225bfe3d.js";import{u as G,a as re,h as oe,b as _e,_ as pe}from"./CommentCard-8d66654f.js";import{b as fe}from"./store-c05763a0.js";const ge={__name:"FilterSelection",setup(R){const q=G(),{pageSorter:f}=q,v=N(""),y=()=>{v.value==="scoreOrderAsc"?f("score",1,"asc"):v.value==="scoreOrderDesc"?f("score",1,"desc"):v.value==="DateOrderAsc"?f("createDate",1,"desc"):v.value==="DateOrderDesc"&&f("createDate",1,"asc")},a=[{value:"scoreOrderDesc",label:"評分高到低"},{value:"scoreOrderAsc",label:"評分低到高"},{value:"DateOrderAsc",label:"由新到舊"},{value:"DateOrderDesc",label:"由舊到新"}];return Z(()=>{v.value="DateOrderAsc"}),(D,_)=>{const I=s("el-option"),k=s("el-select");return n(),O(k,{modelValue:v.value,"onUpdate:modelValue":_[0]||(_[0]=g=>v.value=g),class:"m-2",style:{"margin-right":"-1px"},onChange:y},{default:l(()=>[(n(),i(A,null,M(a,g=>e(I,{key:g.value,label:g.label,value:g.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])}}},ve={class:"text-dark"},ye={class:"text-grey"},he={key:0},be=o("h5",{class:"mb-4"},"填寫基本資訊",-1),ke={key:1},we=o("h5",{class:"mb-4"},"心得分享",-1),xe={key:0},Ve={key:1},De={__name:"CommentModal",setup(R){const q=le(),{user:f}=F(q),v=G(),{modalPage:y,form:a,isOpen:D}=F(v),{submitComment:_,closeModal:I}=v,k=N("匿名");se(k,async()=>{k.value==="匿名"?a.value.userId=0:k.value==="本人"&&(f.value.id===0?te.confirm("尚未登入","請先登入帳號",{confirmButtonText:"OK",cancelButtonText:"取消",type:"warning"}).then(()=>{k.value="匿名"}):a.value.userId=f.value.id)});const g=new Date().getFullYear(),S=[];for(let m=0;m<50;m+=1)S.push(g-m);const E=m=>{a.value.advantages.forEach((c,b)=>{m.value===c.value&&(a.value.advantages[b].status=!a.value.advantages[b].status)})},C=m=>{a.value.disAdvantages.forEach((c,b)=>{m.value===c.value&&(a.value.disAdvantages[b].status=!a.value.disAdvantages[b].status)})},Y=N(null),T=X({anonymous:[{required:!0,message:"請輸入必填內容",trigger:"blur"}],hoildayYear:[{required:!0,message:"請輸入必填內容",trigger:"change"}],workDays:[{required:!0,message:"請輸入必填內容",trigger:"blur"},{type:"number",message:"請輸入數字",trigger:"blur"},{type:"number",min:1,message:"必須大於0",trigger:"blur"}],workHours:[{required:!0,message:"請輸入必填內容",trigger:"blur"},{type:"number",message:"請輸入數字",trigger:"blur"},{type:"number",min:1,message:"必須大於0",trigger:"blur"}]}),h=N(null),x=X({score:[{required:!0,message:"請輸入必填內容",trigger:"blur"}],description:[{required:!0,message:"請輸入必填內容",trigger:"blur"}]}),$=()=>{Y.value.validate(m=>{m&&(y.value=2)})},w=async()=>{h.value.validate(m=>{m&&h.value&&h.value.clearValidate()}),await _()},z=m=>{te.confirm("資料將不會保留，確定離開嗎？").then(()=>{m(),Y.value&&Y.value.clearValidate(),h.value&&h.value.clearValidate(),I()})};return(m,c)=>{const b=s("el-radio-button"),P=s("el-radio-group"),V=s("el-form-item"),W=s("el-option"),j=s("el-select"),U=s("el-input-number"),u=s("el-form"),L=s("el-check-tag"),J=s("el-rate"),H=s("el-input"),Q=s("el-button"),ce=s("el-dialog");return n(),O(ce,{modelValue:t(D),"onUpdate:modelValue":c[7]||(c[7]=r=>ee(D)?D.value=r:null),style:{width:"90%","max-width":"600px",overflow:"hidden"},"before-close":z},{footer:l(()=>[t(y)===1?(n(),i("div",xe,[e(Q,{type:"primary",onClick:$},{default:l(()=>[p(" 下一頁 ")]),_:1})])):(n(),i("div",Ve,[e(Q,{onClick:c[6]||(c[6]=r=>y.value=1)},{default:l(()=>[p(" 上一頁 ")]),_:1}),e(Q,{type:"primary",onClick:w},{default:l(()=>[p(" 送出")]),_:1})]))]),default:l(()=>[o("div",null,[o("h2",ve,[p(" 評論撰寫 "),o("span",ye,"("+d(t(y))+"/2)",1)]),t(y)===1?(n(),i("div",he,[be,e(u,{"label-position":"top","label-width":"100px",model:t(a),ref_key:"formRef1",ref:Y,rules:T},{default:l(()=>[e(V,{label:"評論身份",prop:"anonymous"},{default:l(()=>[e(P,{modelValue:k.value,"onUpdate:modelValue":c[0]||(c[0]=r=>k.value=r)},{default:l(()=>[e(b,{label:"匿名"}),e(b,{label:"本人"})]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"換宿年份",prop:"hoildayYear"},{default:l(()=>[e(j,{modelValue:t(a).hoildayYear,"onUpdate:modelValue":c[1]||(c[1]=r=>t(a).hoildayYear=r),placeholder:"選擇年份",style:{width:"240px"}},{default:l(()=>[(n(),i(A,null,M(S,r=>e(W,{key:r,label:r,value:r},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"換宿周數",prop:"workDays"},{default:l(()=>[e(U,{modelValue:t(a).workDays,"onUpdate:modelValue":c[2]||(c[2]=r=>t(a).workDays=r),modelModifiers:{number:!0},style:{width:"240px"},min:0},null,8,["modelValue"])]),_:1}),e(V,{label:" 換宿日工時",prop:"workHours"},{default:l(()=>[e(U,{modelValue:t(a).workHours,"onUpdate:modelValue":c[3]||(c[3]=r=>t(a).workHours=r),modelModifiers:{number:!0},style:{width:"240px"},min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])):(n(),i("div",ke,[we,e(u,{"label-position":"top","label-width":"100px",model:t(a),ref_key:"formRef2",ref:h,rules:x},{default:l(()=>[e(V,{label:"優點福利"},{default:l(()=>[(n(!0),i(A,null,M(t(a).advantages,r=>(n(),O(L,{checked:r.status,onChange:ue=>E(r),key:r.value,class:"me-1 mb-1"},{default:l(()=>[p(d(r.value),1)]),_:2},1032,["checked","onChange"]))),128))]),_:1}),e(V,{label:"有待改善"},{default:l(()=>[(n(!0),i(A,null,M(t(a).disAdvantages,r=>(n(),O(L,{checked:r.status,onChange:ue=>C(r),key:r.value,class:"me-1 mb-1"},{default:l(()=>[p(d(r.value),1)]),_:2},1032,["checked","onChange"]))),128))]),_:1}),e(V,{label:"整體評分",prop:"score"},{default:l(()=>[e(J,{modelValue:t(a).score,"onUpdate:modelValue":c[4]||(c[4]=r=>t(a).score=r),size:"large"},null,8,["modelValue"])]),_:1}),e(V,{label:"換宿內容分享",prop:"description"},{default:l(()=>[e(H,{modelValue:t(a).description,"onUpdate:modelValue":c[5]||(c[5]=r=>t(a).description=r),rows:5,type:"textarea",placeholder:"分享你的換宿生活，有關店家環境、工作狀況和換宿生活等"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]))])]),_:1},8,["modelValue"])}}},Ce=R=>ae("post","/replys",R),$e=R=>ae("delete",`/replys/${R}`),Ie={class:"d-flex mb-2",style:{"justify-content":"space-between"}},Se={class:"d-flex"},Ue=["src"],qe={class:"text-grey"},Ye={key:0,class:"text-dark"},Oe={class:"card-light-tag",style:{"align-self":"flex-start"}},Ae={style:{"margin-bottom":"0px"}},Me={class:"text-grey"},Re={class:"mb-1 me-1"},Be=o("span",null,"小時",-1),Fe=o("span",{class:"me-1"},"·",-1),Ee={class:"mb-1"},He=o("span",null,"周",-1),Ne={class:"mb-2 text-dark"},Te={key:0},ze={key:0},Pe=["src"],We={style:{"flex-grow":"1"},class:"text-dark"},je={class:"text-grey"},Le={style:{height:"22px",width:"29px"},class:"d-flex align-center"},Ke={class:"d-flex mb-3"},Ge=["src"],Je={style:{"flex-grow":"1"}},Qe={class:"text-dark"},Xe={__name:"CommentDetailModal",setup(R){const q=le(),{user:f}=F(q),v=de(()=>f.value.id!==0),y=N(!1),a=re(),{isDetailOpen:D,commentDetail:_,commentId:I}=F(a),{fetchComment:k}=a,g=X({}),S=async()=>{y.value?g.userId=0:g.userId=f.value.id,g.createDate=Date.now(),g.commentId=Number(I.value);try{await Ce(g),await k(),K({message:"新增成功",type:"success"}),g.content=""}catch{K({message:"新增失敗",type:"error"})}},E=async h=>{try{await $e(h),await k(),K({message:"刪除成功",type:"success"})}catch{K({message:"刪除失敗",type:"error"})}},C=ne(),Y=ie(),T=async()=>{D.value=!1;const{storeId:h}=C.query,x=G(),{pageSorter:$}=x,{sorterInfo:w}=F(x);await $(w.value.nowType,w.value.nowPage,w.value.nowSorter),Y.push(`/storeDetail/${h}`)};return se(()=>C.query.commentId,async()=>{C.query.commentId&&(I.value=C.query.commentId,await k())}),Z(async()=>{C.query.commentId&&(I.value=C.query.commentId,await k())}),(h,x)=>{const $=s("font-awesome-icon"),w=s("el-tag"),z=s("el-divider"),m=s("el-dropdown-item"),c=s("el-dropdown-menu"),b=s("el-dropdown"),P=s("el-input"),V=s("el-checkbox"),W=s("el-button"),j=s("el-dialog");return n(),O(j,{modelValue:t(D),"onUpdate:modelValue":x[2]||(x[2]=U=>ee(D)?D.value=U:null),style:{width:"90%","max-width":"600px"},"before-close":T},{default:l(()=>{var U;return[o("div",null,[o("div",Ie,[o("div",Se,[(U=t(_).user)!=null&&U.imgUrl?(n(),i("img",{key:0,src:t(_).user.imgUrl,class:"me-2 profileImg"},null,8,Ue)):B("",!0),o("div",qe,[t(_).user.name?(n(),i("h4",Ye,d(t(_).user.name),1)):B("",!0),o("p",null,d(t(oe)(t(_).createDate).format("YYYY-MM-DD")),1)])]),o("div",Oe,[o("h5",Ae,[e($,{icon:["fas","star"],class:"me-1"}),p(d(t(_).score)+" 分 ",1)])])]),o("div",null,[o("p",Me,[o("span",Re,[e($,{icon:["fas","clock"],class:"me-1"}),p("日工時： "+d(t(_).workHours)+" ",1),Be]),Fe,o("span",Ee,[e($,{icon:["fas","calendar-days"],class:"me-1"}),p("換宿： "+d(t(_).workDays)+" ",1),He])])]),o("p",Ne,d(t(_).description),1),(n(!0),i(A,null,M(t(_).advantages,u=>(n(),i("span",{key:u},[u.status?(n(),i("span",Te,[e(w,{class:"me-1",type:"info"},{default:l(()=>[p(d(u.value),1)]),_:2},1024)])):B("",!0)]))),128)),(n(!0),i(A,null,M(t(_).disAdvantages,u=>(n(),i("span",{key:u},[u.status?(n(),i("span",ze,[e(w,{class:"me-1",type:"info"},{default:l(()=>[p(d(u.value),1)]),_:2},1024)])):B("",!0)]))),128)),e(_e,{comment:t(_)},null,8,["comment"]),e(z,{class:"my-2"}),(n(!0),i(A,null,M(t(_).replys,u=>(n(),i("div",{class:"d-flex mb-3 text-grey",key:u.id},[o("img",{src:u.imgUrl,class:"me-2 profileImg"},null,8,Pe),o("div",We,[o("h4",null,d(u.name),1),o("p",null,d(u.content),1),o("p",je,d(t(oe)(u.createDate).format("YYYY-MM-DD")),1)]),o("div",null,[u.userId===t(f).id&&t(f).id!==0?(n(),O(b,{key:0,trigger:"click"},{dropdown:l(()=>[e(c,null,{default:l(()=>[e(m,{onClick:L=>E(u.id)},{default:l(()=>[p("刪除")]),_:2},1032,["onClick"])]),_:2},1024)]),default:l(()=>[o("span",null,[o("div",Le,[e($,{icon:["fas","ellipsis-vertical"]})])])]),_:2},1024)):B("",!0)])]))),128)),o("div",Ke,[o("img",{src:t(f).imgUrl,class:"me-2 profileImg mb-3"},null,8,Ge),o("div",Je,[o("h4",Qe,d(t(f).name),1),e(P,{modelValue:g.content,"onUpdate:modelValue":x[0]||(x[0]=u=>g.content=u),rows:3,type:"textarea",placeholder:"輸入回覆...",class:"mb-1"},null,8,["modelValue"]),o("div",null,[t(v)?(n(),O(V,{key:0,modelValue:y.value,"onUpdate:modelValue":x[1]||(x[1]=u=>y.value=u)},{default:l(()=>[p("匿名回覆")]),_:1},8,["modelValue"])):B("",!0)]),e(W,{type:"primary",onClick:S},{default:l(()=>[p("送出")]),_:1})])])])]}),_:1},8,["modelValue"])}}},Ze={class:"d-flex align-center mb-2"},et={class:"me-2"},tt={class:"rounded block"},ot={class:"d-flex align-center"},lt={class:"me-2 text-accent"},st={class:"text-grey mb-2"},at={class:"mb-1"},nt={class:"mb-1"},rt={class:"mb-1"},ct=o("span",null,"小時",-1),ut={class:"mb-1"},dt=o("span",null,"周",-1),it={class:"d-flex align-center",style:{"justify-content":"space-between",height:"64px"}},mt={class:"text-grey bold",style:{margin:"0"}},_t={key:1,class:"text-center text-grey py-3"},pt=o("h5",null,"尚無評論",-1),yt={__name:"StoreDetail",setup(R){const q=G(),{comments:f,allComments:v,storeId:y,sorterInfo:a,form:D,type:_,isOpen:I,averageWorkDays:k,averageWorkHours:g,averageScore:S}=F(q),{pageSorter:E,fetchAllComments:C}=q,Y=re(),{isDetailOpen:T}=F(Y),h=N({}),x=async()=>{const{data:m}=await fe(y.value);h.value=m},$=()=>{I.value=!0,_.value="create",D.value.storeId=y.value},w=ne();w.params.id?y.value=parseInt(w.params.id,10):w.query.storeId&&w.query.commentId&&(y.value=parseInt(w.query.storeId,10),T.value=!0);const z=async m=>{await E(a.value.nowType,m,a.value.nowSorter)};return Z(async()=>{await x(),await C(y.value),await E("createDate",1,"desc")}),(m,c)=>{const b=s("font-awesome-icon"),P=s("router-link"),V=s("el-image"),W=s("el-rate"),j=s("el-button"),U=s("el-card"),u=s("el-col"),L=s("el-pagination"),J=s("el-row");return n(),i("div",null,[e(Xe),e(De),e(me,null,{default:l(()=>[e(P,{to:{name:"searchStore"},class:"text-primary bold router-link mb-1"},{default:l(()=>[e(b,{icon:["fas","arrow-left"],class:"me-1"}),p("返回搜尋")]),_:1}),e(J,{gutter:20,class:"mt-2"},{default:l(()=>[e(u,{xs:24,md:8},{default:l(()=>[e(U,null,{default:l(()=>[o("div",Ze,[o("div",et,[o("div",tt,[e(V,{style:{width:"100px",height:"100px"},src:h.value.imgUrl,fit:"cover",class:"rounded"},null,8,["src"])])]),o("div",null,[o("h3",null,d(h.value.name),1),o("div",ot,[o("h2",lt,d(t(S)),1),e(W,{modelValue:t(S),"onUpdate:modelValue":c[0]||(c[0]=H=>ee(S)?S.value=H:null),disabled:"",colors:["#F48C2B","#F48C2B","#F48C2B"],size:"large"},null,8,["modelValue"])])])]),o("div",st,[o("p",at,[e(b,{icon:["fas","location-dot"],class:"me-1"}),p(d(h.value.address),1)]),o("p",nt,[e(b,{icon:["fas","phone"],class:"me-1"}),p(d(h.value.tel),1)]),o("p",rt,[e(b,{icon:["fas","clock"],class:"me-1"}),p("平均工時： "+d(t(g))+" ",1),ct]),o("p",ut,[e(b,{icon:["fas","calendar-days"],class:"me-1"}),p("平均換宿： "+d(t(k))+" ",1),dt])]),e(j,{type:"primary",style:{display:"block",margin:"auto"},size:"large",onClick:$},{default:l(()=>[p("撰寫貼文")]),_:1})]),_:1})]),_:1}),e(u,{xs:24,md:16},{default:l(()=>[o("div",it,[o("p",mt,d(t(v).length)+" 則評論",1),t(v).length?(n(),O(ge,{key:0})):B("",!0)]),t(v).length?(n(!0),i(A,{key:0},M(t(f),H=>(n(),i("div",{key:H.id},[e(pe,{comment:H,isAction:!0},null,8,["comment"])]))),128)):(n(),i("div",_t,[e(b,{icon:["fas","face-sad-tear"],style:{width:"80",height:"80"},class:"mb-1"}),pt])),e(L,{background:"",layout:"prev, pager, next",total:t(v).length,onCurrentChange:z,"hide-on-single-page":t(f).length===10||t(f).length<10,"current-page":t(a).nowPage},null,8,["total","hide-on-single-page","current-page"])]),_:1})]),_:1})]),_:1})])}}};export{yt as default};
