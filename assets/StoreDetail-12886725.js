import{r as j,i as ee,a,o as r,l as R,w as l,c as m,F as B,m as F,b as e,s as se,v as E,x as le,y as Z,h as o,z as t,f as p,t as d,A as K,E as te,B as ae,C as ie,n as ne,u as de,q as U,D as G,G as me,W as _e}from"./index-207066be.js";import{u as J,a as re,h as oe,b as pe,_ as ge}from"./CommentCard-2c9ed250.js";import{b as fe}from"./store-48f4022b.js";const ve={__name:"FilterSelection",setup(T){const Y=J(),{pageSorter:v}=Y,b=j(""),y=()=>{b.value==="scoreOrderAsc"?v("score",1,"asc"):b.value==="scoreOrderDesc"?v("score",1,"desc"):b.value==="DateOrderAsc"?v("createDate",1,"desc"):b.value==="DateOrderDesc"&&v("createDate",1,"asc")},s=[{value:"scoreOrderDesc",label:"評分高到低"},{value:"scoreOrderAsc",label:"評分低到高"},{value:"DateOrderAsc",label:"由新到舊"},{value:"DateOrderDesc",label:"由舊到新"}];return ee(()=>{b.value="DateOrderAsc"}),(h,_)=>{const q=a("el-option"),D=a("el-select");return r(),R(D,{modelValue:b.value,"onUpdate:modelValue":_[0]||(_[0]=g=>b.value=g),class:"m-2",style:{"margin-right":"-1px"},onChange:y},{default:l(()=>[(r(),m(B,null,F(s,g=>e(q,{key:g.value,label:g.label,value:g.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])}}},ye={class:"text-grey cursor-pointer p",style:{"text-align":"end"}},he={style:{"margin-top":"-20px"}},be={class:"text-dark"},ke={class:"text-grey"},we={key:0},xe=o("h5",{class:"mb-4"},"填寫基本資訊",-1),Ve={key:1},Ce=o("h5",{class:"mb-4"},"心得分享",-1),De={key:0},$e={key:1},Ie={__name:"CommentModal",setup(T){const Y=se(),{user:v}=E(Y),b=J(),{modalPage:y,form:s,isOpen:h}=E(b),{submitComment:_,closeModal:q}=b;le(s.value,async()=>{s.value.anonymous==="匿名"?s.value.userId=0:s.value.anonymous==="本人"&&(v.value.id===0?te.confirm("尚未登入","請先登入帳號",{confirmButtonText:"OK",cancelButtonText:"取消",type:"warning",showClose:!1}).then(()=>{s.value.anonymous="匿名"}):s.value.userId=v.value.id)});const D=new Date().getFullYear(),g=[];for(let i=0;i<50;i+=1)g.push(D-i);const N=i=>{s.value.advantages.forEach((c,w)=>{i.value===c.value&&(s.value.advantages[w].status=!s.value.advantages[w].status)})},O=i=>{s.value.disAdvantages.forEach((c,w)=>{i.value===c.value&&(s.value.disAdvantages[w].status=!s.value.disAdvantages[w].status)})},k=j(null),L=Z({anonymous:[{required:!0,message:"請輸入必填內容",trigger:"blur"}],hoildayYear:[{required:!0,message:"請輸入必填內容",trigger:"change"}],workDays:[{required:!0,message:"請輸入必填內容",trigger:"blur"},{type:"number",message:"請輸入數字",trigger:"blur"},{type:"number",min:1,message:"必須大於0",trigger:"blur"}],workHours:[{required:!0,message:"請輸入必填內容",trigger:"blur"},{type:"number",message:"請輸入數字",trigger:"blur"},{type:"number",min:1,message:"必須大於0",trigger:"blur"}]}),$=j(null),A=Z({score:[{required:!0,message:"請輸入必填內容",trigger:"blur"}],description:[{required:!0,message:"請輸入必填內容",trigger:"blur"}]}),f=()=>{k.value.validate(i=>{i&&(y.value=2)})},C=async()=>{$.value.validate(i=>{i&&$.value&&$.value.clearValidate()}),await _()},I=i=>{te.confirm("資料將不會保留，確定離開嗎？",{showClose:!1}).then(()=>{i(),k.value&&k.value.clearValidate(),$.value&&$.value.clearValidate(),q()})};return(i,c)=>{const w=a("font-awesome-icon"),z=a("el-radio-button"),S=a("el-radio-group"),V=a("el-form-item"),P=a("el-option"),W=a("el-select"),x=a("el-input-number"),u=a("el-form"),H=a("el-check-tag"),Q=a("el-rate"),X=a("el-input"),M=a("el-button"),ce=a("el-dialog");return r(),R(ce,{modelValue:t(h),"onUpdate:modelValue":c[7]||(c[7]=n=>K(h)?h.value=n:null),style:{width:"90%","max-width":"600px"},"before-close":I,"show-close":!1,"align-center":"",class:"el-dialog"},{header:l(({close:n})=>[o("div",ye,[e(w,{icon:["fas","xmark"],onClick:n,style:{"font-size":"20px"}},null,8,["onClick"])])]),footer:l(()=>[t(y)===1?(r(),m("div",De,[e(M,{type:"primary",onClick:f},{default:l(()=>[p(" 下一頁 ")]),_:1})])):(r(),m("div",$e,[e(M,{onClick:c[6]||(c[6]=n=>y.value=1)},{default:l(()=>[p(" 上一頁 ")]),_:1}),e(M,{type:"primary",onClick:C},{default:l(()=>[p(" 送出")]),_:1})]))]),default:l(()=>[o("div",he,[o("h2",be,[p(" 評論撰寫 "),o("span",ke,"("+d(t(y))+"/2)",1)]),t(y)===1?(r(),m("div",we,[xe,e(u,{"label-position":"top","label-width":"100px",model:t(s),ref_key:"formRef1",ref:k,rules:L},{default:l(()=>[e(V,{label:"評論身份",prop:"anonymous"},{default:l(()=>[e(S,{modelValue:t(s).anonymous,"onUpdate:modelValue":c[0]||(c[0]=n=>t(s).anonymous=n)},{default:l(()=>[e(z,{label:"匿名"}),e(z,{label:"本人"})]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"換宿年份",prop:"hoildayYear"},{default:l(()=>[e(W,{modelValue:t(s).hoildayYear,"onUpdate:modelValue":c[1]||(c[1]=n=>t(s).hoildayYear=n),placeholder:"選擇年份",style:{width:"240px"}},{default:l(()=>[(r(),m(B,null,F(g,n=>e(P,{key:n,label:n,value:n},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"換宿周數",prop:"workDays"},{default:l(()=>[e(x,{modelValue:t(s).workDays,"onUpdate:modelValue":c[2]||(c[2]=n=>t(s).workDays=n),modelModifiers:{number:!0},style:{width:"240px"},min:0},null,8,["modelValue"])]),_:1}),e(V,{label:" 換宿日工時",prop:"workHours"},{default:l(()=>[e(x,{modelValue:t(s).workHours,"onUpdate:modelValue":c[3]||(c[3]=n=>t(s).workHours=n),modelModifiers:{number:!0},style:{width:"240px"},min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])):(r(),m("div",Ve,[Ce,e(u,{"label-position":"top","label-width":"100px",model:t(s),ref_key:"formRef2",ref:$,rules:A},{default:l(()=>[e(V,{label:"優點福利"},{default:l(()=>[(r(!0),m(B,null,F(t(s).advantages,n=>(r(),R(H,{checked:n.status,onChange:ue=>N(n),key:n.value,class:"me-1 mb-1 check-tag"},{default:l(()=>[p(d(n.value),1)]),_:2},1032,["checked","onChange"]))),128))]),_:1}),e(V,{label:"有待改善"},{default:l(()=>[(r(!0),m(B,null,F(t(s).disAdvantages,n=>(r(),R(H,{checked:n.status,onChange:ue=>O(n),key:n.value,class:"me-1 mb-1 check-tag"},{default:l(()=>[p(d(n.value),1)]),_:2},1032,["checked","onChange"]))),128))]),_:1}),e(V,{label:"整體評分",prop:"score"},{default:l(()=>[e(Q,{modelValue:t(s).score,"onUpdate:modelValue":c[4]||(c[4]=n=>t(s).score=n),size:"large"},null,8,["modelValue"])]),_:1}),e(V,{label:"換宿內容分享",prop:"description"},{default:l(()=>[e(X,{modelValue:t(s).description,"onUpdate:modelValue":c[5]||(c[5]=n=>t(s).description=n),rows:5,type:"textarea",placeholder:"分享你的換宿生活，有關店家環境、工作狀況和換宿生活等"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]))])]),_:1},8,["modelValue"])}}},Se=T=>ae("post","/replys",T),Ue=T=>ae("delete",`/replys/${T}`),qe={class:"text-grey cursor-pointer",style:{"text-align":"end"}},Ye={class:"d-flex mb-2",style:{"justify-content":"space-between","margin-top":"-20px"}},Oe={class:"d-flex"},Ae=["src"],Me={class:"text-grey"},Re={key:0,class:"text-dark"},Be={class:"card-light-tag",style:{"align-self":"flex-start"}},Fe={style:{"margin-bottom":"0px"}},Te={class:"text-grey"},ze={class:"mb-1 me-1"},Ee=o("span",null,"小時",-1),He=o("span",{class:"me-1"},"·",-1),Ne={class:"mb-1"},Le=o("span",null,"周",-1),Pe={class:"mb-2 text-dark"},We={key:0},je={key:0},Ge={style:{width:"56px",height:"56px"},class:"me-2"},Ke=["src"],Je={style:{"flex-grow":"1"},class:"text-dark"},Qe={class:"text-grey"},Xe={style:{height:"22px",width:"29px"},class:"d-flex align-center"},Ze={class:"d-flex mb-3"},et=["src"],tt={style:{"flex-grow":"1"}},ot={class:"text-dark"},st={__name:"CommentDetailModal",setup(T){const Y=se(),{user:v}=E(Y),b=ie(()=>v.value.id!==0),y=j(!1),s=re(),{isDetailOpen:h,commentDetail:_,commentId:q}=E(s),{fetchComment:D}=s,g=Z({}),N=async()=>{y.value?g.userId=0:g.userId=v.value.id,g.createDate=Date.now(),g.commentId=Number(q.value);try{await Se(g),await D(),G({message:"新增成功",type:"success"}),g.content=""}catch{G({message:"新增失敗",type:"error"})}},O=async A=>{try{await Ue(A),await D(),G({message:"刪除成功",type:"success"})}catch{G({message:"刪除失敗",type:"error"})}},k=ne(),L=de(),$=async()=>{h.value=!1;const{storeId:A}=k.query,f=J(),{pageSorter:C}=f,{sorterInfo:I}=E(f);await C(I.value.nowType,I.value.nowPage,I.value.nowSorter),L.push(`/storeDetail/${A}`)};return le(()=>k.query.commentId,async()=>{k.query.commentId&&(q.value=k.query.commentId,await D())}),ee(async()=>{k.query.commentId&&(q.value=k.query.commentId,await D())}),(A,f)=>{const C=a("font-awesome-icon"),I=a("el-tag"),i=a("el-divider"),c=a("el-dropdown-item"),w=a("el-dropdown-menu"),z=a("el-dropdown"),S=a("el-input"),V=a("el-checkbox"),P=a("el-button"),W=a("el-dialog");return t(h)?(r(),R(W,{key:0,modelValue:t(h),"onUpdate:modelValue":f[2]||(f[2]=x=>K(h)?h.value=x:null),style:{width:"90%","max-width":"600px"},"before-close":$,class:"el-dialog","show-close":!1,visible:t(h),"onUpdate:visible":f[3]||(f[3]=x=>K(h)?h.value=x:null),"align-center":""},{header:l(({close:x})=>[o("div",qe,[e(C,{icon:["fas","xmark"],onClick:x,style:{"font-size":"20px"}},null,8,["onClick"])])]),default:l(()=>{var x;return[o("div",null,[o("div",Ye,[o("div",Oe,[(x=t(_).user)!=null&&x.imgUrl?(r(),m("img",{key:0,src:t(_).user.imgUrl,class:"me-2 profileImg"},null,8,Ae)):U("",!0),o("div",Me,[t(_).user.name?(r(),m("h4",Re,d(t(_).user.name),1)):U("",!0),o("p",null,d(t(oe)(t(_).createDate).format("YYYY-MM-DD")),1)])]),o("div",Be,[o("h5",Fe,[e(C,{icon:["fas","star"],class:"me-1"}),p(d(t(_).score)+" 分 ",1)])])]),o("div",null,[o("p",Te,[o("span",ze,[e(C,{icon:["fas","clock"],class:"me-1"}),p("日工時： "+d(t(_).workHours)+" ",1),Ee]),He,o("span",Ne,[e(C,{icon:["fas","calendar-days"],class:"me-1"}),p("換宿： "+d(t(_).workDays)+" ",1),Le])])]),o("p",Pe,d(t(_).description),1),(r(!0),m(B,null,F(t(_).advantages,u=>(r(),m("span",{key:u},[u.status?(r(),m("span",We,[e(I,{class:"me-1",type:"info","disable-transitions":"",style:{"margin-bottom":"4px"}},{default:l(()=>[p(d(u.value),1)]),_:2},1024)])):U("",!0)]))),128)),(r(!0),m(B,null,F(t(_).disAdvantages,u=>(r(),m("span",{key:u},[u.status?(r(),m("span",je,[e(I,{class:"me-1",type:"info","disable-transitions":""},{default:l(()=>[p(d(u.value),1)]),_:2},1024)])):U("",!0)]))),128)),e(pe,{comment:t(_)},null,8,["comment"]),e(i,{class:"my-2"}),(r(!0),m(B,null,F(t(_).replys,u=>(r(),m("div",{class:"d-flex mb-3 text-grey",key:u.id},[o("div",Ge,[o("img",{src:u.imgUrl,class:"profileImg"},null,8,Ke)]),o("div",Je,[o("h4",null,d(u.name),1),o("p",null,d(u.content),1),o("p",Qe,d(t(oe)(u.createDate).format("YYYY-MM-DD")),1)]),o("div",null,[u.userId===t(v).id&&t(v).id!==0?(r(),R(z,{key:0,trigger:"click"},{dropdown:l(()=>[e(w,null,{default:l(()=>[e(c,{onClick:H=>O(u.id)},{default:l(()=>[p("刪除")]),_:2},1032,["onClick"])]),_:2},1024)]),default:l(()=>[o("span",null,[o("div",Xe,[e(C,{icon:["fas","ellipsis-vertical"]})])])]),_:2},1024)):U("",!0)])]))),128)),o("div",Ze,[o("img",{src:t(v).imgUrl,class:"me-2 profileImg mb-3"},null,8,et),o("div",tt,[o("h4",ot,d(t(v).name),1),e(S,{modelValue:g.content,"onUpdate:modelValue":f[0]||(f[0]=u=>g.content=u),rows:3,type:"textarea",placeholder:"輸入回覆...",class:"mb-1"},null,8,["modelValue"]),o("div",null,[t(b)?(r(),R(V,{key:0,modelValue:y.value,"onUpdate:modelValue":f[1]||(f[1]=u=>y.value=u)},{default:l(()=>[p("匿名回覆")]),_:1},8,["modelValue"])):U("",!0)]),e(P,{type:"primary",onClick:N},{default:l(()=>[p("送出")]),_:1})])])])]}),_:1},8,["modelValue","visible"])):U("",!0)}}},lt={class:"d-flex align-center mb-2"},at={class:"me-2"},nt={class:"rounded block"},rt={class:"d-flex align-center"},ct={class:"me-2 text-accent"},ut={class:"text-grey mb-2"},it={class:"mb-1"},dt={class:"mb-1"},mt={class:"mb-1"},_t=o("span",null,"小時",-1),pt={class:"mb-1"},gt=o("span",null,"周",-1),ft={class:"d-flex align-center",style:{"justify-content":"space-between",height:"64px"}},vt={class:"text-grey bold",style:{margin:"0"}},yt={key:1,class:"text-center text-grey py-3"},ht=o("h5",null,"尚無評論",-1),xt={__name:"StoreDetail",setup(T){const Y=me();Y.setIsLoading();const v=J(),{comments:b,allComments:y,storeId:s,sorterInfo:h,form:_,type:q,isOpen:D,averageWorkDays:g,averageWorkHours:N,averageScore:O}=E(v),{pageSorter:k,fetchAllComments:L}=v,$=re(),{isDetailOpen:A}=E($),f=j({}),C=async()=>{const{data:w}=await fe(s.value);f.value=w},I=()=>{D.value=!0,q.value="create",_.value.storeId=s.value},i=ne();i.params.id?s.value=parseInt(i.params.id,10):i.query.storeId&&i.query.commentId&&(s.value=parseInt(i.query.storeId,10),A.value=!0);const c=async w=>{await k(h.value.nowType,w,h.value.nowSorter),window.scrollTo(0,0)};return ee(async()=>{await C(),await L(s.value),await k("createDate",1,"desc"),Y.setIsLoading()}),(w,z)=>{const S=a("font-awesome-icon"),V=a("router-link"),P=a("el-image"),W=a("el-rate"),x=a("el-button"),u=a("el-card"),H=a("el-col"),Q=a("el-pagination"),X=a("el-row");return r(),m("div",null,[e(st),e(Ie),e(_e,null,{default:l(()=>[e(V,{to:{name:"searchStore"},class:"text-primary bold router-link mb-1"},{default:l(()=>[e(S,{icon:["fas","arrow-left"],class:"me-1"}),p("返回搜尋")]),_:1}),e(X,{gutter:20,class:"mt-2"},{default:l(()=>[e(H,{xs:24,md:8},{default:l(()=>[e(u,null,{default:l(()=>[o("div",lt,[o("div",at,[o("div",nt,[e(P,{style:{width:"100px",height:"100px"},src:f.value.imgUrl,fit:"cover",class:"rounded"},null,8,["src"])])]),o("div",null,[o("h3",null,d(f.value.name),1),o("div",rt,[o("h2",ct,d(t(O)),1),e(W,{modelValue:t(O),"onUpdate:modelValue":z[0]||(z[0]=M=>K(O)?O.value=M:null),disabled:"",colors:["#F48C2B","#F48C2B","#F48C2B"],size:"large"},null,8,["modelValue"])])])]),o("div",ut,[o("p",it,[e(S,{icon:["fas","location-dot"],class:"me-1"}),p(d(f.value.address),1)]),o("p",dt,[e(S,{icon:["fas","phone"],class:"me-1"}),p(d(f.value.tel),1)]),o("p",mt,[e(S,{icon:["fas","clock"],class:"me-1"}),p("平均工時： "+d(t(N))+" ",1),_t]),o("p",pt,[e(S,{icon:["fas","calendar-days"],class:"me-1"}),p("平均換宿： "+d(t(g))+" ",1),gt])]),e(x,{type:"primary",style:{display:"block",margin:"auto"},size:"large",onClick:I},{default:l(()=>[p("撰寫貼文")]),_:1})]),_:1})]),_:1}),e(H,{xs:24,md:16},{default:l(()=>[o("div",ft,[o("p",vt,d(t(y).length)+" 則評論",1),t(y).length?(r(),R(ve,{key:0})):U("",!0)]),t(y).length?(r(!0),m(B,{key:0},F(t(b),M=>(r(),m("div",{key:M.id},[e(ge,{comment:M,isAction:!0},null,8,["comment"])]))),128)):U("",!0),t(y).length===0?(r(),m("div",yt,[e(S,{icon:["fas","face-sad-tear"],style:{width:"80",height:"80"},class:"mb-1"}),ht])):U("",!0),e(Q,{background:"",layout:"prev, pager, next",total:t(y).length,onCurrentChange:c,"hide-on-single-page":t(b).length===10||t(b).length<10,"current-page":t(h).nowPage},null,8,["total","hide-on-single-page","current-page"])]),_:1})]),_:1})]),_:1})])}}};export{xt as default};
