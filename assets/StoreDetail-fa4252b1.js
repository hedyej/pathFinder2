import{r as z,i as Z,a,o as n,k as F,w as s,c as i,F as E,j as H,b as e,v as le,x as N,y as ae,z as X,A as t,f as _,h as o,t as d,B as ee,E as oe,C as ne,_ as ie,D as me,m as re,u as _e,q as M,G,p as pe,g as fe,l as ge,W as ve}from"./index-c6f64e6c.js";import{u as K,a as ce,h as se,b as he,_ as ye}from"./CommentCard-f9b7342d.js";import{b as be}from"./store-6d2d0e3c.js";const ke={__name:"FilterSelection",setup(D){const O=K(),{pageSorter:g}=O,y=z(""),v=()=>{y.value==="scoreOrderAsc"?g("score",1,"asc"):y.value==="scoreOrderDesc"?g("score",1,"desc"):y.value==="DateOrderAsc"?g("createDate",1,"desc"):y.value==="DateOrderDesc"&&g("createDate",1,"asc")},l=[{value:"scoreOrderDesc",label:"評分高到低"},{value:"scoreOrderAsc",label:"評分低到高"},{value:"DateOrderAsc",label:"由新到舊"},{value:"DateOrderDesc",label:"由舊到新"}];return Z(()=>{y.value="DateOrderAsc"}),(k,m)=>{const U=a("el-option"),b=a("el-select");return n(),F(b,{modelValue:y.value,"onUpdate:modelValue":m[0]||(m[0]=p=>y.value=p),class:"m-2",style:{"margin-right":"-1px"},onChange:v},{default:s(()=>[(n(),i(E,null,H(l,p=>e(U,{key:p.value,label:p.label,value:p.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])}}},we={class:"text-dark"},xe={class:"text-grey"},Ve={key:0},De=o("h5",{class:"mb-4"},"填寫基本資訊",-1),Ce={key:1},$e=o("h5",{class:"mb-4"},"心得分享",-1),Ie={key:0},Se={key:1},Ue={__name:"CommentModal",setup(D){const O=le(),{user:g}=N(O),y=K(),{modalPage:v,form:l,isOpen:k}=N(y),{submitComment:m,closeModal:U}=y,b=z("匿名");ae(b,async()=>{b.value==="匿名"?l.value.userId=0:b.value==="本人"&&(g.value.id===0?oe.confirm("尚未登入","請先登入帳號",{confirmButtonText:"OK",cancelButtonText:"取消",type:"warning"}).then(()=>{b.value="匿名"}):l.value.userId=g.value.id)});const p=new Date().getFullYear(),T=[];for(let f=0;f<50;f+=1)T.push(p-f);const A=f=>{l.value.advantages.forEach((c,x)=>{f.value===c.value&&(l.value.advantages[x].status=!l.value.advantages[x].status)})},C=f=>{l.value.disAdvantages.forEach((c,x)=>{f.value===c.value&&(l.value.disAdvantages[x].status=!l.value.disAdvantages[x].status)})},R=z(null),P=X({anonymous:[{required:!0,message:"請輸入必填內容",trigger:"blur"}],hoildayYear:[{required:!0,message:"請輸入必填內容",trigger:"change"}],workDays:[{required:!0,message:"請輸入必填內容",trigger:"blur"},{type:"number",message:"請輸入數字",trigger:"blur"},{type:"number",min:1,message:"必須大於0",trigger:"blur"}],workHours:[{required:!0,message:"請輸入必填內容",trigger:"blur"},{type:"number",message:"請輸入數字",trigger:"blur"},{type:"number",min:1,message:"必須大於0",trigger:"blur"}]}),w=z(null),h=X({score:[{required:!0,message:"請輸入必填內容",trigger:"blur"}],description:[{required:!0,message:"請輸入必填內容",trigger:"blur"}]}),$=()=>{R.value.validate(f=>{f&&(v.value=2)})},I=async()=>{w.value.validate(f=>{f&&w.value&&w.value.clearValidate()}),await m()},q=f=>{oe.confirm("資料將不會保留，確定離開嗎？").then(()=>{f(),R.value&&R.value.clearValidate(),w.value&&w.value.clearValidate(),U()})};return(f,c)=>{const x=a("el-radio-button"),S=a("el-radio-group"),V=a("el-form-item"),W=a("el-option"),j=a("el-select"),Y=a("el-input-number"),u=a("el-form"),L=a("el-check-tag"),J=a("el-rate"),Q=a("el-input"),B=a("el-button"),ue=a("el-dialog");return n(),F(ue,{modelValue:t(k),"onUpdate:modelValue":c[7]||(c[7]=r=>ee(k)?k.value=r:null),style:{width:"90%","max-width":"600px",overflow:"hidden"},"before-close":q},{footer:s(()=>[t(v)===1?(n(),i("div",Ie,[e(B,{type:"primary",onClick:$},{default:s(()=>[_(" 下一頁 ")]),_:1})])):(n(),i("div",Se,[e(B,{onClick:c[6]||(c[6]=r=>v.value=1)},{default:s(()=>[_(" 上一頁 ")]),_:1}),e(B,{type:"primary",onClick:I},{default:s(()=>[_(" 送出")]),_:1})]))]),default:s(()=>[o("div",null,[o("h2",we,[_(" 評論撰寫 "),o("span",xe,"("+d(t(v))+"/2)",1)]),t(v)===1?(n(),i("div",Ve,[De,e(u,{"label-position":"top","label-width":"100px",model:t(l),ref_key:"formRef1",ref:R,rules:P},{default:s(()=>[e(V,{label:"評論身份",prop:"anonymous"},{default:s(()=>[e(S,{modelValue:b.value,"onUpdate:modelValue":c[0]||(c[0]=r=>b.value=r)},{default:s(()=>[e(x,{label:"匿名"}),e(x,{label:"本人"})]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"換宿年份",prop:"hoildayYear"},{default:s(()=>[e(j,{modelValue:t(l).hoildayYear,"onUpdate:modelValue":c[1]||(c[1]=r=>t(l).hoildayYear=r),placeholder:"選擇年份",style:{width:"240px"}},{default:s(()=>[(n(),i(E,null,H(T,r=>e(W,{key:r,label:r,value:r},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"換宿周數",prop:"workDays"},{default:s(()=>[e(Y,{modelValue:t(l).workDays,"onUpdate:modelValue":c[2]||(c[2]=r=>t(l).workDays=r),modelModifiers:{number:!0},style:{width:"240px"},min:0},null,8,["modelValue"])]),_:1}),e(V,{label:" 換宿日工時",prop:"workHours"},{default:s(()=>[e(Y,{modelValue:t(l).workHours,"onUpdate:modelValue":c[3]||(c[3]=r=>t(l).workHours=r),modelModifiers:{number:!0},style:{width:"240px"},min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])):(n(),i("div",Ce,[$e,e(u,{"label-position":"top","label-width":"100px",model:t(l),ref_key:"formRef2",ref:w,rules:h},{default:s(()=>[e(V,{label:"優點福利"},{default:s(()=>[(n(!0),i(E,null,H(t(l).advantages,r=>(n(),F(L,{checked:r.status,onChange:de=>A(r),key:r.value,class:"me-1 mb-1 check-tag"},{default:s(()=>[_(d(r.value),1)]),_:2},1032,["checked","onChange"]))),128))]),_:1}),e(V,{label:"有待改善"},{default:s(()=>[(n(!0),i(E,null,H(t(l).disAdvantages,r=>(n(),F(L,{checked:r.status,onChange:de=>C(r),key:r.value,class:"me-1 mb-1 check-tag"},{default:s(()=>[_(d(r.value),1)]),_:2},1032,["checked","onChange"]))),128))]),_:1}),e(V,{label:"整體評分",prop:"score"},{default:s(()=>[e(J,{modelValue:t(l).score,"onUpdate:modelValue":c[4]||(c[4]=r=>t(l).score=r),size:"large"},null,8,["modelValue"])]),_:1}),e(V,{label:"換宿內容分享",prop:"description"},{default:s(()=>[e(Q,{modelValue:t(l).description,"onUpdate:modelValue":c[5]||(c[5]=r=>t(l).description=r),rows:5,type:"textarea",placeholder:"分享你的換宿生活，有關店家環境、工作狀況和換宿生活等"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]))])]),_:1},8,["modelValue"])}}},qe=D=>ne("post","/replys",D),Ye=D=>ne("delete",`/replys/${D}`);const te=D=>(pe("data-v-d7f9fa14"),D=D(),fe(),D),Me={class:"d-flex mb-2",style:{"justify-content":"space-between"}},Oe={class:"d-flex"},Ae=["src"],Re={class:"text-grey"},Be={key:0,class:"text-dark"},Fe={class:"card-light-tag",style:{"align-self":"flex-start"}},Ee={style:{"margin-bottom":"0px"}},He={class:"text-grey"},Ne={class:"mb-1 me-1"},Te=te(()=>o("span",null,"小時",-1)),Le=te(()=>o("span",{class:"me-1"},"·",-1)),ze={class:"mb-1"},Pe=te(()=>o("span",null,"周",-1)),We={class:"mb-2 text-dark"},je={key:0},Ge={key:0},Ke=["src"],Je={style:{"flex-grow":"1"},class:"text-dark"},Qe={class:"text-grey"},Xe={style:{height:"22px",width:"29px"},class:"d-flex align-center"},Ze={class:"d-flex mb-3"},et=["src"],tt={style:{"flex-grow":"1"}},ot={class:"text-dark"},st={__name:"CommentDetailModal",setup(D){const O=le(),{user:g}=N(O),y=me(()=>g.value.id!==0),v=z(!1),l=ce(),{isDetailOpen:k,commentDetail:m,commentId:U}=N(l),{fetchComment:b}=l,p=X({}),T=async()=>{v.value?p.userId=0:p.userId=g.value.id,p.createDate=Date.now(),p.commentId=Number(U.value);try{await qe(p),await b(),G({message:"新增成功",type:"success"}),p.content=""}catch{G({message:"新增失敗",type:"error"})}},A=async w=>{try{await Ye(w),await b(),G({message:"刪除成功",type:"success"})}catch{G({message:"刪除失敗",type:"error"})}},C=re(),R=_e(),P=async()=>{k.value=!1;const{storeId:w}=C.query,h=K(),{pageSorter:$}=h,{sorterInfo:I}=N(h);await $(I.value.nowType,I.value.nowPage,I.value.nowSorter),R.push(`/storeDetail/${w}`)};return ae(()=>C.query.commentId,async()=>{C.query.commentId&&(U.value=C.query.commentId,await b())}),Z(async()=>{C.query.commentId&&(U.value=C.query.commentId,await b())}),(w,h)=>{const $=a("font-awesome-icon"),I=a("el-tag"),q=a("el-divider"),f=a("el-dropdown-item"),c=a("el-dropdown-menu"),x=a("el-dropdown"),S=a("el-input"),V=a("el-checkbox"),W=a("el-button"),j=a("el-dialog");return n(),F(j,{modelValue:t(k),"onUpdate:modelValue":h[2]||(h[2]=Y=>ee(k)?k.value=Y:null),style:{width:"90%","max-width":"600px"},"before-close":P,class:"el-dialog"},{default:s(()=>{var Y;return[o("div",null,[o("div",Me,[o("div",Oe,[(Y=t(m).user)!=null&&Y.imgUrl?(n(),i("img",{key:0,src:t(m).user.imgUrl,class:"me-2 profileImg"},null,8,Ae)):M("",!0),o("div",Re,[t(m).user.name?(n(),i("h4",Be,d(t(m).user.name),1)):M("",!0),o("p",null,d(t(se)(t(m).createDate).format("YYYY-MM-DD")),1)])]),o("div",Fe,[o("h5",Ee,[e($,{icon:["fas","star"],class:"me-1"}),_(d(t(m).score)+" 分 ",1)])])]),o("div",null,[o("p",He,[o("span",Ne,[e($,{icon:["fas","clock"],class:"me-1"}),_("日工時： "+d(t(m).workHours)+" ",1),Te]),Le,o("span",ze,[e($,{icon:["fas","calendar-days"],class:"me-1"}),_("換宿： "+d(t(m).workDays)+" ",1),Pe])])]),o("p",We,d(t(m).description),1),(n(!0),i(E,null,H(t(m).advantages,u=>(n(),i("span",{key:u},[u.status?(n(),i("span",je,[e(I,{class:"me-1",type:"info"},{default:s(()=>[_(d(u.value),1)]),_:2},1024)])):M("",!0)]))),128)),(n(!0),i(E,null,H(t(m).disAdvantages,u=>(n(),i("span",{key:u},[u.status?(n(),i("span",Ge,[e(I,{class:"me-1",type:"info"},{default:s(()=>[_(d(u.value),1)]),_:2},1024)])):M("",!0)]))),128)),e(he,{comment:t(m)},null,8,["comment"]),e(q,{class:"my-2"}),(n(!0),i(E,null,H(t(m).replys,u=>(n(),i("div",{class:"d-flex mb-3 text-grey",key:u.id},[o("img",{src:u.imgUrl,class:"me-2 profileImg"},null,8,Ke),o("div",Je,[o("h4",null,d(u.name),1),o("p",null,d(u.content),1),o("p",Qe,d(t(se)(u.createDate).format("YYYY-MM-DD")),1)]),o("div",null,[u.userId===t(g).id&&t(g).id!==0?(n(),F(x,{key:0,trigger:"click"},{dropdown:s(()=>[e(c,null,{default:s(()=>[e(f,{onClick:L=>A(u.id)},{default:s(()=>[_("刪除")]),_:2},1032,["onClick"])]),_:2},1024)]),default:s(()=>[o("span",null,[o("div",Xe,[e($,{icon:["fas","ellipsis-vertical"]})])])]),_:2},1024)):M("",!0)])]))),128)),o("div",Ze,[o("img",{src:t(g).imgUrl,class:"me-2 profileImg mb-3"},null,8,et),o("div",tt,[o("h4",ot,d(t(g).name),1),e(S,{modelValue:p.content,"onUpdate:modelValue":h[0]||(h[0]=u=>p.content=u),rows:3,type:"textarea",placeholder:"輸入回覆...",class:"mb-1"},null,8,["modelValue"]),o("div",null,[t(y)?(n(),F(V,{key:0,modelValue:v.value,"onUpdate:modelValue":h[1]||(h[1]=u=>v.value=u)},{default:s(()=>[_("匿名回覆")]),_:1},8,["modelValue"])):M("",!0)]),e(W,{type:"primary",onClick:T},{default:s(()=>[_("送出")]),_:1})])])])]}),_:1},8,["modelValue"])}}},lt=ie(st,[["__scopeId","data-v-d7f9fa14"]]),at={class:"d-flex align-center mb-2"},nt={class:"me-2"},rt={class:"rounded block"},ct={class:"d-flex align-center"},ut={class:"me-2 text-accent"},dt={class:"text-grey mb-2"},it={class:"mb-1"},mt={class:"mb-1"},_t={class:"mb-1"},pt=o("span",null,"小時",-1),ft={class:"mb-1"},gt=o("span",null,"周",-1),vt={class:"d-flex align-center",style:{"justify-content":"space-between",height:"64px"}},ht={class:"text-grey bold",style:{margin:"0"}},yt={key:1,class:"text-center text-grey py-3"},bt=o("h5",null,"尚無評論",-1),Vt={__name:"StoreDetail",setup(D){const O=ge();O.setIsLoading();const g=K(),{comments:y,allComments:v,storeId:l,sorterInfo:k,form:m,type:U,isOpen:b,averageWorkDays:p,averageWorkHours:T,averageScore:A}=N(g),{pageSorter:C,fetchAllComments:R}=g,P=ce(),{isDetailOpen:w}=N(P),h=z({}),$=async()=>{const{data:c}=await be(l.value);h.value=c},I=()=>{b.value=!0,U.value="create",m.value.storeId=l.value},q=re();q.params.id?l.value=parseInt(q.params.id,10):q.query.storeId&&q.query.commentId&&(l.value=parseInt(q.query.storeId,10),w.value=!0);const f=async c=>{await C(k.value.nowType,c,k.value.nowSorter)};return Z(async()=>{await $(),await R(l.value),await C("createDate",1,"desc"),O.setIsLoading()}),(c,x)=>{const S=a("font-awesome-icon"),V=a("router-link"),W=a("el-image"),j=a("el-rate"),Y=a("el-button"),u=a("el-card"),L=a("el-col"),J=a("el-pagination"),Q=a("el-row");return n(),i("div",null,[e(lt),e(Ue),e(ve,null,{default:s(()=>[e(V,{to:{name:"searchStore"},class:"text-primary bold router-link mb-1"},{default:s(()=>[e(S,{icon:["fas","arrow-left"],class:"me-1"}),_("返回搜尋")]),_:1}),e(Q,{gutter:20,class:"mt-2"},{default:s(()=>[e(L,{xs:24,md:8},{default:s(()=>[e(u,null,{default:s(()=>[o("div",at,[o("div",nt,[o("div",rt,[e(W,{style:{width:"100px",height:"100px"},src:h.value.imgUrl,fit:"cover",class:"rounded"},null,8,["src"])])]),o("div",null,[o("h3",null,d(h.value.name),1),o("div",ct,[o("h2",ut,d(t(A)),1),e(j,{modelValue:t(A),"onUpdate:modelValue":x[0]||(x[0]=B=>ee(A)?A.value=B:null),disabled:"",colors:["#F48C2B","#F48C2B","#F48C2B"],size:"large"},null,8,["modelValue"])])])]),o("div",dt,[o("p",it,[e(S,{icon:["fas","location-dot"],class:"me-1"}),_(d(h.value.address),1)]),o("p",mt,[e(S,{icon:["fas","phone"],class:"me-1"}),_(d(h.value.tel),1)]),o("p",_t,[e(S,{icon:["fas","clock"],class:"me-1"}),_("平均工時： "+d(t(T))+" ",1),pt]),o("p",ft,[e(S,{icon:["fas","calendar-days"],class:"me-1"}),_("平均換宿： "+d(t(p))+" ",1),gt])]),e(Y,{type:"primary",style:{display:"block",margin:"auto"},size:"large",onClick:I},{default:s(()=>[_("撰寫貼文")]),_:1})]),_:1})]),_:1}),e(L,{xs:24,md:16},{default:s(()=>[o("div",vt,[o("p",ht,d(t(v).length)+" 則評論",1),t(v).length?(n(),F(ke,{key:0})):M("",!0)]),t(v).length?(n(!0),i(E,{key:0},H(t(y),B=>(n(),i("div",{key:B.id},[e(ye,{comment:B,isAction:!0},null,8,["comment"])]))),128)):M("",!0),t(v).length===0?(n(),i("div",yt,[e(S,{icon:["fas","face-sad-tear"],style:{width:"80",height:"80"},class:"mb-1"}),bt])):M("",!0),e(J,{background:"",layout:"prev, pager, next",total:t(v).length,onCurrentChange:f,"hide-on-single-page":t(y).length===10||t(y).length<10,"current-page":t(k).nowPage},null,8,["total","hide-on-single-page","current-page"])]),_:1})]),_:1})]),_:1})])}}};export{Vt as default};
